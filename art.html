<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethereal Particle Flow Field – P5.js Generative Art</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>

    <!-- p5.js CDN (version 1.4.0 as requested) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>

    <script>
        // =====================================================
        // ETHEREAL PARTICLE FLOW FIELD
        // Features:
        // • 1500 glowing particles with variable size (depth illusion)
        // • Multi-octave 3D Perlin noise flow field (smooth + detailed)
        // • Time-evolving pentadic HSV color palette (cosmic rainbow shift)
        // • Additive blending + subtle background fade → glowing trails
        // • Mouse attraction with inverse-distance force
        // • Edge wrapping + full-window responsive canvas
        // =====================================================

        let particles = [];
        const numParticles = 1500;

        let zOff = 0;                 // Third dimension for 3D Perlin noise
        const noiseScale = 0.005;     // Controls field detail
        const zSpeed = 0.002;         // Evolution speed of the field

        function setup() {
            createCanvas(windowWidth, windowHeight);
            blendMode(ADD);             // Crucial for glowing additive effect
            colorMode(HSB, 360, 100, 100, 100);

            // Initialize particles with random positions and sizes
            for (let i = 0; i < numParticles; i++) {
                particles.push(new Particle());
            }

            background(0);
        }

        function draw() {
            // Subtle fade for beautiful motion trails
            fill(0, 5);
            noStroke();
            rect(0, 0, width, height);

            // Slowly animate base hue over time
            let baseHue = (frameCount * 0.1) % 360;

            // Increment z-offset for 3D noise evolution
            zOff += zSpeed;

            // Update and display every particle
            for (let p of particles) {
                p.update(baseHue, zOff);
                p.display();
            }
        }

        // -----------------------------------------------------
        // Particle Class
        // -----------------------------------------------------
        class Particle {
            constructor() {
                this.pos = createVector(random(width), random(height));
                this.vel = createVector(0, 0);
                this.acc = createVector(0, 0);
                this.size = random(1, 4);           // Larger = closer feel
                this.maxSpeed = 3;
                this.forceMult = 0.15;
            }

            update(baseHue, zOffset) {
                // ----- Flow field force from multi-octave 3D Perlin noise -----
                let xOff = this.pos.x * noiseScale;
                let yOff = this.pos.y * noiseScale;

                // Base layer
                let angle = noise(xOff, yOff, zOffset) * TWO_PI * 2;
                // Octave layer (2× scale, half strength) for richer detail
                let angle2 = noise(xOff * 2, yOff * 2, zOffset + 1000) * TWO_PI * 2;

                let fieldForce = p5.Vector.fromAngle(angle + 0.5 * angle2);
                fieldForce.mult(this.forceMult);
                this.acc.add(fieldForce);

                // ----- Mouse attraction (only when mouse is pressed) -----
                if (mouseIsPressed) {
                    let mouse = createVector(mouseX, mouseY);
                    let dir = p5.Vector.sub(mouse, this.pos);
                    let dist = dir.mag();
                    if (dist < 300) {                 // Limit range for performance
                        dir.normalize();
                        let strength = 0.05 * (1 / (dist + 1)); // Inverse distance
                        dir.mult(strength);
                        this.acc.add(dir);
                    }
                }

                // ----- Physics integration -----
                this.vel.add(this.acc);
                this.vel.limit(this.maxSpeed);
                this.pos.add(this.vel);
                this.acc.mult(0);                    // Clear acceleration

                // Edge wrapping
                this.edges();
            }

            display() {
                // Pentadic hue offsets (72° apart) create harmonious color spread
                let hueOffsetIndex = floor((this.pos.x + this.pos.y) * 0.01) % 5;
                let hue = (baseHue + hueOffsetIndex * 72) % 360;

                // Brighter and more saturated for larger (closer) particles
                let sat = 80;
                let val = map(this.size, 1, 4, 70, 100);

                // Alpha 8 gives soft glowing trails with additive blending
                fill(hue, sat, val, 8);
                noStroke();
                circle(this.pos.x, this.pos.y, this.size);
            }

            edges() {
                if (this.pos.x > width) this.pos.x = 0;
                if (this.pos.x < 0) this.pos.x = width;
                if (this.pos.y > height) this.pos.y = 0;
                if (this.pos.y < 0) this.pos.y = height;
            }
        }

        // -----------------------------------------------------
        // Responsive canvas
        // -----------------------------------------------------
        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
            background(0);
        }

        // -----------------------------------------------------
        // Extra: Click to reset field (optional fun)
        // -----------------------------------------------------
        function mousePressed() {
            // Particles will naturally be attracted while button held
        }

        // =====================================================
        // Aesthetic & Technical Notes
        // • blendMode(ADD) + low alpha → ethereal glowing trails
        // • Multi-octave 3D noise prevents repetitive patterns
        // • Time-shifting baseHue + pentadic offsets → cosmic color breathing
        // • Variable particle size + brightness → convincing depth
        // • Inverse-distance mouse force feels organic and powerful
        // • Performance: 1500 particles run smoothly on modern devices
        //   (reduce to 800–1000 on lower-end hardware)
        // =====================================================
    </script>
</body>

</html>